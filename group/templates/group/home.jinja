{% extends "group/base.html" %}
{% block title %}Home{% endblock %}
{% block content %}
{% if my_groups %}
<div>
    <h5>我加入的小组</h5>
    <ul>
        {% for my_group in my_groups %}
        <li style="font-size: 16px;">
        {% if my_group.group.icon_url %}
        <img width="64" height="64" src="{{my_group.group.icon_url}}" class="entity-detail__avatar">
        {% endif %}
        <a href="#">{{my_group.group.name}}</a>
        - {{my_group.group.description | truncate(40)}}
        </li>
        {% endfor %}
    </ul>
</div>
<div class="dividing-line"></div>
{% endif %}

{% macro topics_list(topics, title) %}
<div>
    <h5>{{ title  }}</h5>
    <ul>
        {% for topic in topics %}
        <li>
        <a href="#">{{topic.title}}</a> - from <a href="#">{{topic.group.name}}</a>
        </li>
        {% endfor %}
    </ul>
</div>
{%- endmacro %}

{% if my_groups_topics %}
{{ topics_list(my_groups_topics, '我加入的小组最新帖子') }}
<div class="dividing-line"></div>
{% endif %}

<div>
    <h5>全部小组</h5>
    <ul>
        {% for group in groups %}
        <li style="font-size: 16px;">
        {% if group.icon_url %}
        <img width="64" height="64" src="{{group.icon_url}}" class="entity-detail__avatar">
        {% endif %}
        <a href="#">{{group.name}}</a>
        - {{group.description | truncate(40)}}
        </li>
        {% endfor %}
    </ul>
</div>

<div class="dividing-line"></div>

{{ topics_list(last_topics, '最新帖子') }}

<div class="dividing-line"></div>
<div>
    <h5>最新回复</h5>
    <ul>
        {% for comment in last_comments %}
        <li>
        <a href="#">{{comment.content}}</a> - from <a href="#">{{comment.user.mastodon_username}}</a>
        </li>
        {% endfor %}
    </ul>
</div>

<div class="dividing-line"></div>
<div>
    <h5>最新加入的用户</h5>
    <ul>
        {% for user in last_join_users %}
        <li>
        <img width="32" height="32" src="{{ user.mastodon_account.avatar }}" class="user-profile__avatar mast-avatar">
        </li>
        {% endfor %}
    </ul>
</div>
{% endblock %}

{% block sidebar %}
    {% if request.user.is_authenticated %}
    {%include "partial/_sidebar.html"%}
    {% endif %}
{% endblock %}
